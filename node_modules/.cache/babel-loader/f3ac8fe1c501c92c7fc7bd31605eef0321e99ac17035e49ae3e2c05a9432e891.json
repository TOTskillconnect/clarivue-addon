{"ast":null,"code":"import { __awaiter as i } from \"../../../../node_modules/.pnpm/@rollup_plugin-typescript@11.1.6_rollup@4.24.4_tslib@2.6.3_typescript@4.9.5/node_modules/tslib/tslib.es6.js\";\nimport { ORIGIN_LIST_FETCH_TIMEOUT_IN_MS as t, validOriginsCdnEndpoint as r, validOriginsFallback as n } from \"./constants.js\";\nimport { GlobalVars as e } from \"./globalVars.js\";\nimport { getLogger as o } from \"./telemetry.js\";\nimport { inServerSideRenderingEnvironment as l, isValidHttpsURL as s } from \"./utils.js\";\nlet a = [];\nconst u = o(\"validateOrigin\");\nfunction c() {\n  return i(this, void 0, void 0, function* () {\n    yield d();\n  });\n}\nfunction d() {\n  let e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !1;\n  return i(this, void 0, void 0, function* () {\n    if (0 !== a.length && !e) return a;\n    if (l()) return a = n, n;\n    {\n      u(\"Initiating fetch call to acquire valid origins list from CDN\");\n      const i = new AbortController(),\n        e = setTimeout(() => i.abort(), t);\n      return fetch(r, {\n        signal: i.signal\n      }).then(i => {\n        if (clearTimeout(e), !i.ok) throw new Error(\"Invalid Response from Fetch Call\");\n        return u(\"Fetch call completed and retrieved valid origins list from CDN\"), i.json().then(i => {\n          if (function (i) {\n            let t = JSON.parse(i);\n            try {\n              t = JSON.parse(i);\n            } catch (i) {\n              return !1;\n            }\n            if (!t.validOrigins) return !1;\n            for (const i of t.validOrigins) try {\n              new URL(\"https://\" + i);\n            } catch (t) {\n              return u(\"isValidOriginsFromCDN call failed to validate origin: %s\", i), !1;\n            }\n            return !0;\n          }(JSON.stringify(i))) return a = i.validOrigins, a;\n          throw new Error(\"Valid origins list retrieved from CDN is invalid\");\n        });\n      }).catch(i => (\"AbortError\" === i.name ? u(\"validOrigins fetch call to CDN failed due to Timeout of \".concat(t, \" ms. Defaulting to fallback list\")) : u(\"validOrigins fetch call to CDN failed with error: %s. Defaulting to fallback list\", i), a = n, a));\n    }\n  });\n}\nfunction f(i, t) {\n  if (\"*.\" === i.substring(0, 2)) {\n    const r = i.substring(1);\n    if (t.length > r.length && t.split(\".\").length === r.split(\".\").length && t.substring(t.length - r.length) === r) return !0;\n  } else if (i === t) return !0;\n  return !1;\n}\nfunction g(i, t) {\n  return d(t).then(t => {\n    if (!s(i)) return u(\"Origin %s is invalid because it is not using https protocol. Protocol being used: %s\", i, i.protocol), !1;\n    const r = i.host;\n    if (t.some(i => f(i, r))) return !0;\n    for (const i of e.additionalValidOrigins) {\n      if (f(\"https://\" === i.substring(0, 8) ? i.substring(8) : i, r)) return !0;\n    }\n    return u(\"Origin %s is invalid because it is not an origin approved by this library or included in the call to app.initialize.\\nOrigins approved by this library: %o\\nOrigins included in app.initialize: %o\", i, t, e.additionalValidOrigins), !1;\n  });\n}\nc();\nexport { c as prefetchOriginsFromCDN, g as validateOrigin };","map":{"version":3,"names":["__awaiter","i","ORIGIN_LIST_FETCH_TIMEOUT_IN_MS","t","validOriginsCdnEndpoint","r","validOriginsFallback","n","GlobalVars","e","getLogger","o","inServerSideRenderingEnvironment","l","isValidHttpsURL","s","a","u","c","d","arguments","length","undefined","AbortController","setTimeout","abort","fetch","signal","then","clearTimeout","ok","Error","json","JSON","parse","validOrigins","URL","stringify","catch","name","concat","f","substring","split","g","protocol","host","some","additionalValidOrigins","prefetchOriginsFromCDN","validateOrigin"],"sources":["/Users/tobitowoju/clarivue-addon/clarivue-addon/node_modules/@microsoft/teams-js/dist/esm/packages/teams-js/src/internal/validOrigins.js"],"sourcesContent":["import{__awaiter as i}from\"../../../../node_modules/.pnpm/@rollup_plugin-typescript@11.1.6_rollup@4.24.4_tslib@2.6.3_typescript@4.9.5/node_modules/tslib/tslib.es6.js\";import{ORIGIN_LIST_FETCH_TIMEOUT_IN_MS as t,validOriginsCdnEndpoint as r,validOriginsFallback as n}from\"./constants.js\";import{GlobalVars as e}from\"./globalVars.js\";import{getLogger as o}from\"./telemetry.js\";import{inServerSideRenderingEnvironment as l,isValidHttpsURL as s}from\"./utils.js\";let a=[];const u=o(\"validateOrigin\");function c(){return i(this,void 0,void 0,(function*(){yield d()}))}function d(e=!1){return i(this,void 0,void 0,(function*(){if(0!==a.length&&!e)return a;if(l())return a=n,n;{u(\"Initiating fetch call to acquire valid origins list from CDN\");const i=new AbortController,e=setTimeout((()=>i.abort()),t);return fetch(r,{signal:i.signal}).then((i=>{if(clearTimeout(e),!i.ok)throw new Error(\"Invalid Response from Fetch Call\");return u(\"Fetch call completed and retrieved valid origins list from CDN\"),i.json().then((i=>{if(function(i){let t=JSON.parse(i);try{t=JSON.parse(i)}catch(i){return!1}if(!t.validOrigins)return!1;for(const i of t.validOrigins)try{new URL(\"https://\"+i)}catch(t){return u(\"isValidOriginsFromCDN call failed to validate origin: %s\",i),!1}return!0}(JSON.stringify(i)))return a=i.validOrigins,a;throw new Error(\"Valid origins list retrieved from CDN is invalid\")}))})).catch((i=>(\"AbortError\"===i.name?u(`validOrigins fetch call to CDN failed due to Timeout of ${t} ms. Defaulting to fallback list`):u(\"validOrigins fetch call to CDN failed with error: %s. Defaulting to fallback list\",i),a=n,a)))}}))}function f(i,t){if(\"*.\"===i.substring(0,2)){const r=i.substring(1);if(t.length>r.length&&t.split(\".\").length===r.split(\".\").length&&t.substring(t.length-r.length)===r)return!0}else if(i===t)return!0;return!1}function g(i,t){return d(t).then((t=>{if(!s(i))return u(\"Origin %s is invalid because it is not using https protocol. Protocol being used: %s\",i,i.protocol),!1;const r=i.host;if(t.some((i=>f(i,r))))return!0;for(const i of e.additionalValidOrigins){if(f(\"https://\"===i.substring(0,8)?i.substring(8):i,r))return!0}return u(\"Origin %s is invalid because it is not an origin approved by this library or included in the call to app.initialize.\\nOrigins approved by this library: %o\\nOrigins included in app.initialize: %o\",i,t,e.additionalValidOrigins),!1}))}c();export{c as prefetchOriginsFromCDN,g as validateOrigin};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}